<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Internal Server Error</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        <?php echo file_get_contents(__DIR__ . '/styles.css'); ?>
    </style>
</head>
<body>
    <div class="container">
        <?php foreach($stack as [$e, $trace]): ?>
        <div class="section">
            <h2><?php echo get_class($e); ?></h2>
            <p><?php echo $e->getMessage(); ?></p>
            <p class="quiet"><code><?php echo $e->getFile(); ?></code> on line <code><?php echo $e->getLine(); ?></code></p>

            <?php echo $trace->getContext()->getSnippet(); ?>

            <p><b>Stacktrace</b></p>
            <?php foreach($trace->getFrames() as $frame): ?>
            <div class="frame">
                <div class="frame-header">
                    <span class="quiet">
                        <code><?php echo $frame->getCaller(); ?></code>
                        <?php if($frame->hasFile()): ?>
                        in <code><?php echo $frame->getFile(); ?></code> on line <code><?php echo $frame->getLine(); ?></code>
                        <?php endif; ?>
                    </span>
                </div>
                <?php if($frame->hasContext() || $frame->hasArgument()): ?>
                <div class="frame-body">
                    <?php if($frame->hasContext()): ?>
                    <?php echo $frame->getContext()->getSnippet(); ?>
                    <?php endif; ?>

                    <?php if($frame->hasArgument()): ?>
                    <p><b>Arguments</b></p>
                    <table class="table">
                        <tbody>
                            <?php foreach($frame->getArguments() as $name => $arg): ?>
                            <tr>
                                <td width="20%"><code><?php echo $name; ?></code></td>
                                <td><code><?php echo $arg; ?></code></td>
                            </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                    <?php endif; ?>
                </div>
                <?php endif; ?>
            </div>
            <?php endforeach; ?>
        </div>
        <?php endforeach; ?>
    </div>
    <script>
        (function() {
            const toggle = function(event) {
                let header = event.target;
                while(!header.classList.contains('frame-header')) {
                    header = header.parentNode;
                }
                let frame = header.parentNode,
                    body = frame.querySelector('.frame-body');
                if(body) {
                    event.preventDefault();
                    header.classList.toggle('frame-header--open');
                    body.classList.toggle('frame-body--open');
                }
            };
            const elements = document.querySelectorAll('.frame-header');
            Array.prototype.forEach.call(elements, function(element) {
                element.addEventListener('click', toggle);
            });
        })();
    </script>
</body>
</html>
